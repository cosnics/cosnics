if(typeof dropzoneCallbacks!="undefined"){if(typeof dropzoneCallbacks.chamilo.core==="undefined"){dropzoneCallbacks.chamilo.core={repository:{}}}dropzoneCallbacks.chamilo.core.repository.importImage={processUploadedFile:function(a,b,c){dropzoneCallbacks.chamilo.core.repository.importWithElementFinder.processUploadedFile("image_finder",a,b,c)},prepareRequest:function(a,c,b,d){dropzoneCallbacks.chamilo.core.repository.importWithElementFinder.prepareRequest(a,c,b,d)},deleteUploadedFile:function(a,b,c){dropzoneCallbacks.chamilo.core.repository.importWithElementFinder.deleteUploadedFile("image_finder",a,b,c)}}}$(function(){var w=["#ff0000","#f2ef00","#00ff00","#00ffff","#0000ff","#ff00ff","#0080ff","#ff0080","#00ff80","#ff8000","#8000ff"],h,x=null,l=[],j=0;var u="Chamilo\\Core\\Repository\\ContentObject\\HotspotQuestion\\Ajax";var b=getPath("WEB_PATH")+"index.php";function p(){$(".polygon_fill_"+x,$("#hotspot-selected-image")).remove();$(".polygon_line_"+x,$("#hotspot-selected-image")).remove();$("#hotspot-selected-image").fillPolygon(l[x].X,l[x].Y,{clss:"polygon_fill_"+x,color:w[x],alpha:0.5});$("#hotspot-selected-image").drawPolygon(l[x].X,l[x].Y,{clss:"polygon_line_"+x,color:w[x],stroke:1,alpha:0.9})}function r(){var A=$('input[name="coordinates['+x+']"]'),z=[],y=l[x];$.each(y.X,function(B,C){z.push([C,y.Y[B]])});A.val((serialize(z)))}function i(A,B){if(x!==null){var z,y;h=$("#hotspot-selected-image").offset();z=A.pageX-h.left;y=A.pageY-h.top;z=z.toFixed(0);y=y.toFixed(0);l[x].X.push(parseInt(z,10));l[x].Y.push(parseInt(y,10));p();r()}}function q(y){x=y;l[x]={};l[x].X=[];l[x].Y=[];$(".polygon_fill_"+x,$("#hotspot-selected-image")).remove();$(".polygon_line_"+x,$("#hotspot-selected-image")).remove()}function o(y,z){y.preventDefault();var A=$(this).attr(("id")).replace("reset_","");$("#hotspot_marking .colour_box").css("background-color",w[A]);q(A)}function t(y,z){y.preventDefault();var A=$(this).attr(("id")).replace("edit_","");$("#hotspot_marking .colour_box").css("background-color",w[A]);q(A)}function e(){$('input[name*="coordinates"]').each(function(y){var B=$(this).attr("name"),A=B.substr(12,B.length-13),z=$(this).val();if(z!==""){z=unserialize(z);x=A;q(A);$.each(z,function(C,D){l[A].X.push(D[0]);l[A].Y.push(D[1])});p()}})}function m(){return $(".table-data > tbody > tr:first > td:last .edit_option").attr("src")}function c(){return $(".table-data > tbody > tr:first > td:last .reset_option").attr("src")}function s(){return $(".table-data > tbody > tr:first > td:last .remove_option").attr("src").replace("Na.png",".png")}function v(){var A,z,y;A='<img class="remove_option" src="'+s().replace(".png","Na.png")+'"/>';z='<input id="remove_$option_number" class="remove_option" type="image" src="'+s()+'" name="remove[$option_number]" />';y=$(".table-data > tbody > tr");if(y.size()<=1){z=A}y.each(function(){var B,C,E,D;B=$('input[name*="option_weight"]',this);C=B.attr("name");E=C.substr(14,C.length-15);D=z.replace(/\$option_number/g,E);$(".remove_option",this).remove();$("td:last",this).append(D)})}function k(A,C){A.preventDefault();var F=$(this).parent().parent().parent(),E=$(this).attr("id"),D=0,B;E=E.replace("remove_","");destroyHtmlEditor("answer["+E+"]");destroyHtmlEditor("comment["+E+"]");$("tr#option_"+E,F).remove();$('input[name="coordinates['+E+']"]').remove();B=$("tr",F);var z={application:u,go:"SkipOption","option-number":E};var y=$.ajax({type:"POST",url:b,data:z}).success(function(G){if(G.result_code==200){B.each(function(){var H=D%2===0?"row_even":"row_odd";$(this).attr("class",H);D+=1});j+=1;v();$(".polygon_fill_"+E,$("#hotspot-selected-image")).remove();$(".polygon_line_"+E,$("#hotspot-selected-image")).remove()}})}function d(N,G){N.preventDefault();var J=$("#mc_number_of_options").val(),B=(parseInt(J,10)+1),K=(J-j)%2===0?"row_even":"row_odd",Q="correct["+J+"]",I=Q,H,A,L,z,E,M,F,P,y,D,O,C;setMemory("mc_number_of_options",B);$("#mc_number_of_options").val(B);D={width:"100%",height:"65",collapse_toolbar:true};O="answer["+J+"]";C="comment["+J+"]";H='<div class="colour_box" style="background-color: '+w[J]+';"></div>';A='<input name="coordinates['+J+']" type="hidden" value="" />';L=renderHtmlEditor(O,D);z=renderHtmlEditor(C,D);E='<input class="input_numeric" type="text" value="1" name="option_weight['+J+']" size="2" />';M='<input id="edit_'+J+'" class="edit_option" type="image" src="'+m()+'" name="edit['+J+']" />&nbsp;&nbsp;';F='<input id="reset_'+J+'" class="reset_option" type="image" src="'+c()+'" name="reset['+J+']" />&nbsp;&nbsp;';P='<input id="remove_'+J+'" class="remove_option" type="image" src="'+s()+'" name="remove['+J+']" />';y='<tr id="option_'+J+'" class="'+K+'"><td>'+H+A+"</td><td>"+L+"</td><td>"+z+"</td><td>"+E+"</td><td>"+M+F+P+"</td></tr>";$(".table-data > tbody").append(y);v();$("#hotspot_marking .colour_box").css("background-color",w[J]);q(J)}function g(y,z){$("#hotspot_options").show();$("#hotspot_marking").show();$("#hotspot_marking .colour_box").css("background-color",w[0]);q(0)}function a(z,A){var y=$(this).prop("checked");if(y){$('input[name="weight"]').prop("disabled",true)}else{$('input[name="weight"]').prop("disabled",false)}}function f(){var E=JSON.parse($("#tbl_image_finder #hidden_active_elements").val());var z=E[0].replace("content_object_",""),B;var A="Chamilo\\Core\\Repository\\Ajax";var D=getPath("WEB_PATH")+"index.php";var C={application:A,go:"ImageProperties",content_object:z};var y=$.ajax({type:"POST",url:D,data:C,async:false}).success(function(F){n(F.properties)})}function n(z){z=scaleDimensions(600,450,z);var A=z.thumbnailWidth;var y=z.thumbnailHeight;var B=$("#hotspot-selected-image");B.css("background-image","url("+z.webPath+")");B.css("width",A+"px");B.css("height",y+"px");B.css("background-size",A+"px "+y+"px");$("#hotspot-image-container").show();$("#hotspot-image-select").hide()}$(document).ready(function(){$("#hotspot_javascript").hide();e();$(document).on("click",'button[name*="edit"]',t);$(document).on("click",'button[name*="reset"]',o);$(document).on("click","#hotspot-selected-image",i);$(document).on("click",".remove_option",k);$(document).on("click",".add_option",d);$("#tbl_image_finder").on("click","#activate_button",function(){f();g()});$(document).on("click",'input[name="recalculate_weight"]',a)})});
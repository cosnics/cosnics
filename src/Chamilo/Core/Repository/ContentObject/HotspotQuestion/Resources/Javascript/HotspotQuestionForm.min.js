$(function(){var u=["#ff0000","#f2ef00","#00ff00","#00ffff","#0000ff","#ff00ff","#0080ff","#ff0080","#00ff80","#ff8000","#8000ff"],f,v=null,j=[],h=0;var s="Chamilo\\Core\\Repository\\ContentObject\\HotspotQuestion\\Ajax";var b=getPath("WEB_PATH")+"index.php";function n(){$(".polygon_fill_"+v,$("#selected_image")).remove();$(".polygon_line_"+v,$("#selected_image")).remove();$("#selected_image").fillPolygon(j[v].X,j[v].Y,{clss:"polygon_fill_"+v,color:u[v],alpha:0.5});$("#selected_image").drawPolygon(j[v].X,j[v].Y,{clss:"polygon_line_"+v,color:u[v],stroke:1,alpha:0.9})}function p(){var y=$('input[name="coordinates['+v+']"]'),x=[],w=j[v];$.each(w.X,function(z,A){x.push([A,w.Y[z]])});y.val((serialize(x)))}function g(y,z){if(v!==null){var x,w;f=$("#selected_image").offset();x=y.pageX-f.left;w=y.pageY-f.top;x=x.toFixed(0);w=w.toFixed(0);j[v].X.push(parseInt(x,10));j[v].Y.push(parseInt(w,10));n();p()}}function o(w){v=w;j[v]={};j[v].X=[];j[v].Y=[];$(".polygon_fill_"+v,$("#selected_image")).remove();$(".polygon_line_"+v,$("#selected_image")).remove()}function m(w,x){w.preventDefault();var y=$(this).attr(("id")).replace("reset_","");$("#hotspot_marking .colour_box").css("background-color",u[y]);o(y)}function r(w,x){w.preventDefault();var y=$(this).attr(("id")).replace("edit_","");$("#hotspot_marking .colour_box").css("background-color",u[y]);o(y)}function e(){$('input[name*="coordinates"]').each(function(w){var z=$(this).attr("name"),y=z.substr(12,z.length-13),x=$(this).val();if(x!==""){x=unserialize(x);v=y;o(y);$.each(x,function(A,B){j[y].X.push(B[0]);j[y].Y.push(B[1])});n()}})}function l(){return $(".table-data > tbody > tr:first > td:last .edit_option").attr("src")}function c(){return $(".table-data > tbody > tr:first > td:last .reset_option").attr("src")}function q(){return $(".table-data > tbody > tr:first > td:last .remove_option").attr("src").replace("Na.png",".png")}function t(){var y,x,w;y='<img class="remove_option" src="'+q().replace(".png","Na.png")+'"/>';x='<input id="remove_$option_number" class="remove_option" type="image" src="'+q()+'" name="remove[$option_number]" />';w=$(".table-data > tbody > tr");if(w.size()<=1){x=y}w.each(function(){var z,A,C,B;z=$('input[name*="option_weight"]',this);A=z.attr("name");C=A.substr(14,A.length-15);B=x.replace(/\$option_number/g,C);$(".remove_option",this).remove();$("td:last",this).append(B)})}function i(y,A){y.preventDefault();var D=$(this).parent().parent().parent(),C=$(this).attr("id"),B=0,z;C=C.replace("remove_","");destroyHtmlEditor("answer["+C+"]");destroyHtmlEditor("comment["+C+"]");$("tr#option_"+C,D).remove();$('input[name="coordinates['+C+']"]').remove();z=$("tr",D);var x={application:s,go:"SkipOption","option-number":C};var w=$.ajax({type:"POST",url:b,data:x}).success(function(E){if(E.result_code==200){z.each(function(){var F=B%2===0?"row_even":"row_odd";$(this).attr("class",F);B+=1});h+=1;t();$(".polygon_fill_"+C,$("#selected_image")).remove();$(".polygon_line_"+C,$("#selected_image")).remove()}})}function d(L,E){L.preventDefault();var H=$("#mc_number_of_options").val(),z=(parseInt(H,10)+1),I=(H-h)%2===0?"row_even":"row_odd",O="correct["+H+"]",G=O,F,y,J,x,C,K,D,N,w,B,M,A;setMemory("mc_number_of_options",z);$("#mc_number_of_options").val(z);B={width:"100%",height:"65",collapse_toolbar:true};M="answer["+H+"]";A="comment["+H+"]";F='<div class="colour_box" style="background-color: '+u[H]+';"></div>';y='<input name="coordinates['+H+']" type="hidden" value="" />';J=renderHtmlEditor(M,B);x=renderHtmlEditor(A,B);C='<input class="input_numeric" type="text" value="1" name="option_weight['+H+']" size="2" />';K='<input id="edit_'+H+'" class="edit_option" type="image" src="'+l()+'" name="edit['+H+']" />&nbsp;&nbsp;';D='<input id="reset_'+H+'" class="reset_option" type="image" src="'+c()+'" name="reset['+H+']" />&nbsp;&nbsp;';N='<input id="remove_'+H+'" class="remove_option" type="image" src="'+q()+'" name="remove['+H+']" />';w='<tr id="option_'+H+'" class="'+I+'"><td>'+F+y+"</td><td>"+J+"</td><td>"+x+"</td><td>"+C+"</td><td>"+K+D+N+"</td></tr>";$(".table-data > tbody").append(w);t();$("#hotspot_marking .colour_box").css("background-color",u[H]);o(H)}function k(w,x){$("div.form-label",$("#selected_image").closest("div.row")).remove();$("div.formw",$("#selected_image").closest("div.row")).css("float","left").css("width","100%");$("#hotspot_options").show();$("#hotspot_marking").show();$("#hotspot_marking .colour_box").css("background-color",u[0]);o(0)}function a(x,y){var w=$(this).prop("checked");if(w){$('input[name="weight"]').prop("disabled",true)}else{$('input[name="weight"]').prop("disabled",false)}}$(document).ready(function(){$("#hotspot_javascript").hide();e();$(document).on("click",'button[name*="edit"]',r);$(document).on("click",'button[name*="reset"]',m);$(document).on("click","#selected_image",g);$(document).on("click",".remove_option",i);$(document).on("click",".add_option",d);var w=$('input[name="image"]').val();if(w!=""){$("div.label",$("#selected_image").closest("div.row")).remove();$("div.formw",$("#selected_image").closest("div.row")).css("float","left").css("width","100%")}$('input[name="image"]').change(function(){k()});$(document).on("click",".element_finder_inactive a:not(.disabled, .category)",k);$(document).on("click",'input[name="recalculate_weight"]',a)})});